<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-lg p-6">

        <h2 class="text-xl font-semibold text-gray-800 mb-4">
            {% if object %}
                Editar Compañía
            {% else %}
                Nueva Compañía
            {% endif %}
        </h2>

        <form
            method="post"
            id="company-form"
            action="{% if object %}{% url 'company:company_update' object.pk %}{% else %}{% url 'company:company_create' %}{% endif %}"
        >
            {% csrf_token %}

            {% for field in form %}
            <div class="mb-3">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                    {{ field.label }}
                </label>
                {{ field }}
                {% if field.errors %}
                    <p class="text-sm text-red-600 mt-1">
                        {{ field.errors|striptags }}
                    </p>
                {% endif %}
            </div>
            {% endfor %}

            <div class="flex justify-end space-x-3 pt-4">
                <button
                    type="button"
                    onclick="handleCancel()"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                >
                    Cancelar
                </button>
                <button
                    type="submit"
                    class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                >
                    Guardar
                </button>
            </div>
        </form>

    </div>
</div>

<script>
document.getElementById('company-form').addEventListener('submit', function(e) {
    e.preventDefault();

    fetch(this.action, {
        method: 'POST',
        body: new FormData(this),
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.redirect_url) {

            window.location.href = data.redirect_url;
        } else if (data.html) {
           
            document.getElementById('modal-container').innerHTML = data.html;
        }
    })
    .catch(err => console.error(err));
});

function handleCancel() {
    const modal = document.getElementById('modal-container');
    if (modal) {
        modal.innerHTML = '';
    } else {
        window.location.href = "{% url 'company:company_list' %}";
    }
}
</script>
